<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roll Call Dashboard</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #2563eb;
      --accent-2: #10b981;
      --danger: #ef4444;
      --border: rgba(255,255,255,0.1);
      --chip: #1f2937;
      --focus: #ffffff;
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg), #000);
      min-height: 100vh;
      display: grid;
      place-items: center;
    }

    .container {
      width: min(980px, 94vw);
      padding: 28px;
    }

    .dashboard {
      background: var(--panel);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      border: 1px solid var(--border);
      overflow: hidden;
    }

    header {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .title {
      font-weight: 800;
      letter-spacing: 0.3px;
    }

    .chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: end;
    }

    .chip {
      background: var(--chip);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      color: var(--text);
      font-size: 0.9rem;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 0;
    }

    section {
      padding: 20px;
    }

    section + section {
      border-left: 1px solid var(--border);
    }

    h2 {
      margin: 0 0 12px;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .controls {
      display: grid;
      gap: 12px;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .row-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    label {
      font-size: 0.9rem;
      color: var(--muted);
    }

    input[type="number"], select {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #0b1220;
      color: var(--text);
    }

    .btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      background: #1e293b;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
    }
    button:hover { transform: translateY(-1px); border-color: var(--accent); }
    button:focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; }
    .primary { background: var(--accent); border-color: transparent; color: #fff; }
    .success { background: var(--accent-2); color: #062e0a; }
    .danger { background: var(--danger); color: #fff; }

    .timer-display {
      display: grid;
      grid-template-columns: auto 1fr;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 12px;
    }

    .time {
      font-size: 2rem;
      font-weight: 800;
    }

    .progress {
      height: 10px;
      border-radius: 999px;
      background: #0b1220;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width 200ms linear;
    }

    .current-call {
      display: grid;
      gap: 8px;
      padding: 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .badge-num {
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: 1px;
    }

    .list {
      max-height: 240px;
      overflow: auto;
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .list ul {
      list-style: none;
      margin: 0; padding: 0;
    }
    .list li {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 8px;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid var(--border);
    }
    .list li:last-child { border-bottom: none; }
    .tag {
      padding: 4px 8px;
      border-radius: 999px;
      background: var(--chip);
      border: 1px solid var(--border);
      font-size: 0.8rem;
    }

    .settings {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    .switch {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .switch input { width: auto; }

    @media (max-width: 840px) {
      .grid { grid-template-columns: 1fr; }
      section + section { border-left: none; border-top: 1px solid var(--border); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="dashboard" role="application" aria-label="Roll call dashboard">
      <header>
        <div class="title">Roll Call Dashboard</div>
        <div class="chips">
          <span class="chip">Countdown</span>
          <span class="chip">Number Calling</span>
          <span class="chip">Queue Tracking</span>
        </div>
      </header>

      <div class="grid">
        <!-- Left: Countdown -->
        <section aria-labelledby="countdownTitle">
          <h2 id="countdownTitle">Briefing countdown</h2>
          <div class="controls" role="form" aria-label="Countdown controls">
            <div class="row">
              <div>
                <label for="min">Minutes</label>
                <input id="min" type="number" min="0" value="10" />
              </div>
              <div>
                <label for="sec">Seconds</label>
                <input id="sec" type="number" min="0" max="59" value="0" />
              </div>
              <div>
                <label for="autoReset">Auto reset (min)</label>
                <input id="autoReset" type="number" min="0" value="0" />
              </div>
            </div>

            <div class="btns" role="group" aria-label="Timer actions">
              <button class="primary" id="startBtn">Start</button>
              <button id="pauseBtn">Pause</button>
              <button class="danger" id="resetBtn">Reset</button>
            </div>

            <div class="settings" aria-label="Timer settings">
              <label class="switch">
                <input id="beepToggle" type="checkbox" />
                <span>Beep when time is up</span>
              </label>
            </div>

            <div class="timer-display" aria-live="polite">
              <div class="time" id="timeText">10:00</div>
              <div class="progress" aria-label="Time remaining">
                <div class="bar" id="bar"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Right: Number calling -->
        <section aria-labelledby="callingTitle">
          <h2 id="callingTitle">Badge number calling</h2>

          <div class="controls">
            <div class="row-2">
              <div>
                <label for="startNum">Start number</label>
                <input id="startNum" type="number" value="100" />
              </div>
              <div>
                <label for="endNum">End number</label>
                <input id="endNum" type="number" value="199" />
              </div>
            </div>

            <div class="row-2">
              <div>
                <label for="mode">Mode</label>
                <select id="mode">
                  <option value="sequential" selected>Sequential</option>
                  <option value="random">Random (no repeats)</option>
                </select>
              </div>
              <div>
                <label for="announce">Announce</label>
                <select id="announce">
                  <option value="off" selected>Off</option>
                  <option value="on">Voice announcement</option>
                </select>
              </div>
            </div>

            <div class="btns" role="group" aria-label="Calling actions">
              <button class="primary" id="callBtn">Call next</button>
              <button id="undoBtn">Undo last</button>
              <button class="danger" id="clearBtn">Clear list</button>
            </div>

            <div class="current-call" aria-live="polite">
              <div class="label" style="color: var(--muted)">Current call</div>
              <div class="badge-num" id="currentNum">—</div>
            </div>

            <div class="list" role="region" aria-label="Called queue">
              <ul id="calledList"></ul>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    // ===== Countdown =====
    const minEl = document.getElementById('min');
    const secEl = document.getElementById('sec');
    const autoResetEl = document.getElementById('autoReset');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const beepToggle = document.getElementById('beepToggle');
    const timeText = document.getElementById('timeText');
    const bar = document.getElementById('bar');

    let timerInterval = null;
    let totalMs = 10 * 60 * 1000;
    let remainingMs = totalMs;
    let startedAt = null;

    function updateTimeDisplay(ms) {
      const m = Math.floor(ms / 60000);
      const s = Math.floor((ms % 60000) / 1000);
      timeText.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      const pct = Math.max(0, Math.min(100, (ms / totalMs) * 100));
      bar.style.width = pct + '%';
    }

    function setFromInputs() {
      const m = Math.max(0, parseInt(minEl.value || '0', 10));
      const s = Math.max(0, Math.min(59, parseInt(secEl.value || '0', 10)));
      totalMs = (m * 60 + s) * 1000;
      remainingMs = totalMs;
      updateTimeDisplay(remainingMs);
    }

    function beep() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'square';
        osc.frequency.value = 880;
        gain.gain.value = 0.05;
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        setTimeout(() => osc.stop(), 600);
      } catch (e) { /* silent */ }
    }

    startBtn.addEventListener('click', () => {
      if (timerInterval) return;
      setFromInputs();
      startedAt = performance.now();
      const endAt = startedAt + remainingMs;

      timerInterval = setInterval(() => {
        const now = performance.now();
        remainingMs = Math.max(0, endAt - now);
        updateTimeDisplay(remainingMs);
        if (remainingMs <= 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          if (beepToggle.checked) beep();

          const autoMin = Math.max(0, parseInt(autoResetEl.value || '0', 10));
          if (autoMin > 0) {
            totalMs = autoMin * 60 * 1000;
            remainingMs = totalMs;
            updateTimeDisplay(remainingMs);
          }
        }
      }, 100);
    });

    pauseBtn.addEventListener('click', () => {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    });

    resetBtn.addEventListener('click', () => {
      clearInterval(timerInterval);
      timerInterval = null;
      setFromInputs();
    });

    // Initialize
    setFromInputs();

    // ===== Number Calling =====
    const startNumEl = document.getElementById('startNum');
    const endNumEl = document.getElementById('endNum');
    const modeEl = document.getElementById('mode');
    const announceEl = document.getElementById('announce');
    const callBtn = document.getElementById('callBtn');
    const undoBtn = document.getElementById('undoBtn');
    const clearBtn = document.getElementById('clearBtn');
    const currentNumEl = document.getElementById('currentNum');
    const calledListEl = document.getElementById('calledList');

    let range = { start: 100, end: 199 };
    let called = [];
    let nextSequential = range.start;

    function refreshRange() {
      const s = parseInt(startNumEl.value || '0', 10);
      const e = parseInt(endNumEl.value || '0', 10);
      range.start = Math.min(s, e);
      range.end = Math.max(s, e);
      nextSequential = Math.max(range.start, nextSequential);
    }

    function formatItem(n, index) {
      const li = document.createElement('li');
      const order = document.createElement('span');
      order.className = 'tag';
      order.textContent = `#${index + 1}`;
      const num = document.createElement('span');
      num.textContent = n;
      const meta = document.createElement('span');
      meta.className = 'tag';
      meta.textContent = 'Called';
      li.append(order, num, meta);
      return li;
    }

    function announceNumber(n) {
      if (announceEl.value !== 'on') return;
      if (!('speechSynthesis' in window)) return;
      const text = `Badge ${n}`;
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 1.0;
      utter.pitch = 1.0;
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
    }

    function callNext() {
      refreshRange();

      // Build remaining set
      const total = range.end - range.start + 1;
      if (total <= 0) return;

      let next;
      if (modeEl.value === 'sequential') {
        // Find next uncalled sequential
        next = null;
        for (let n = nextSequential; n <= range.end; n++) {
          if (!called.includes(n)) { next = n; nextSequential = n + 1; break; }
        }
        if (next === null) {
          // wrap from start
          for (let n = range.start; n < nextSequential; n++) {
            if (!called.includes(n)) { next = n; nextSequential = n + 1; break; }
          }
        }
      } else {
        // random unique
        const remaining = [];
        for (let n = range.start; n <= range.end; n++) {
          if (!called.includes(n)) remaining.push(n);
        }
        if (remaining.length === 0) {
          currentNumEl.textContent = 'Complete';
          return;
        }
        const idx = Math.floor(Math.random() * remaining.length);
        next = remaining[idx];
      }

      if (next == null) {
        currentNumEl.textContent = 'Complete';
        return;
      }

      called.push(next);
      currentNumEl.textContent = next;
      announceNumber(next);
      calledListEl.appendChild(formatItem(next, called.length - 1));
    }

    function undoLast() {
      const last = called.pop();
      if (last == null) return;
      currentNumEl.textContent = called.length ? called[called.length - 1] : '—';
      if (calledListEl.lastChild) calledListEl.removeChild(calledListEl.lastChild);
      // Adjust sequential pointer
      if (modeEl.value === 'sequential') {
        nextSequential = Math.min(nextSequential, last);
      }
    }

    function clearList() {
      called = [];
      currentNumEl.textContent = '—';
      calledListEl.innerHTML = '';
      nextSequential = range.start;
    }

    callBtn.addEventListener('click', callNext);
    undoBtn.addEventListener('click', undoLast);
    clearBtn.addEventListener('click', clearList);

    // Update when inputs change
    [startNumEl, endNumEl].forEach(el => el.addEventListener('change', () => {
      refreshRange();
    }));
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sealing Blessing | Ceremony Overlay</title>
  <style>
    :root {
      --bg: #f7f7fb;
      --panel: #ffffff;
      --text: #16181d;
      --muted: #6b7280;
      --accent: #3458ff;
      --accent-2: #2fb986;
      --border: #e5e7eb;
      --focus: rgba(52, 88, 255, 0.22);
    }
    [data-theme="dark"] {
      --bg: #0f1115;
      --panel: #171a22;
      --text: #e7e7ea;
      --muted: #b6b6bf;
      --accent: #6aa0ff;
      --accent-2: #50d3a9;
      --border: #2a2e37;
      --focus: rgba(106,160,255,0.22);
    }
    html, body {
      height: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .container { max-width: 980px; margin: 0 auto; padding: 24px; }
    header {
      display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center;
      margin-bottom: 16px;
    }
    h1 { margin: 0; font-size: 1.6rem; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; }
    button, select {
      background: var(--panel); color: var(--text);
      border: 1px solid var(--border); border-radius: 10px;
      padding: 9px 12px; font-weight: 600; cursor: pointer;
    }
    button:hover, select:hover { border-color: var(--accent); }
    button.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
    button.ghost { background: transparent; }
    .grid { display: grid; grid-template-columns: 320px 1fr; gap: 16px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
    .panel {
      background: var(--panel); border: 1px solid var(--border);
      border-radius: 14px; padding: 16px;
    }
    .panel h2 { margin: 0 0 8px; font-size: 1.2rem; }
    label { font-weight: 700; font-size: 0.9rem; display: block; margin-bottom: 6px; }
    input[type="text"] {
      width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);
      background: transparent; color: var(--text);
    }
    textarea, .editable {
      width: 100%; min-height: 180px; border: 1px solid var(--border);
      border-radius: 12px; padding: 12px; background: transparent; color: var(--text);
      font-size: 1.02rem; line-height: 1.6;
    }
    .editable[contenteditable="true"]:focus, textarea:focus, input:focus {
      outline: 3px solid var(--focus); border-color: var(--accent);
    }
    .muted { color: var(--muted); }
    .progress {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin: 10px 0 14px;
    }
    .dot {
      height: 8px; border-radius: 999px; background: var(--border);
    }
    .dot.on { background: var(--accent-2); }
    .reading {
      position: relative; border: 1px dashed var(--border);
      border-radius: 12px; padding: 16px; min-height: 220px;
    }
    .line { margin: 0 0 12px; padding: 8px 10px; border-radius: 10px; }
    .line.active { background: rgba(52, 88, 255, 0.08); }
    .line small { display: block; color: var(--muted); margin-top: 4px; }
    .affirm {
      margin-top: 8px; padding: 12px; border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(47, 185, 134, 0.12); display: none;
    }
    .affirm.show { display: block; }
    .footer-controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }

    /* Ceremony overlay */
    .ceremony {
      position: fixed; inset: 0; display: none; z-index: 999;
      background: radial-gradient(800px 400px at 30% 20%, rgba(52,88,255,0.12), transparent),
                  radial-gradient(800px 400px at 80% 70%, rgba(47,185,134,0.12), transparent),
                  var(--bg);
      backdrop-filter: blur(2px);
      padding: 24px; overflow-y: auto;
    }
    .ceremony.active { display: block; }
    .ceremony-inner { max-width: 900px; margin: 0 auto; }
    .focus-ring {
      border: 2px solid var(--accent); border-radius: 16px; padding: 18px;
      animation: breathe 6s ease-in-out infinite;
    }
    @keyframes breathe {
      0% { box-shadow: 0 0 0 0 rgba(52,88,255,0.35); }
      50% { box-shadow: 0 0 0 16px rgba(52,88,255,0.0); }
      100% { box-shadow: 0 0 0 0 rgba(52,88,255,0.35); }
    }
    .sr-only {
      position: absolute !important; height: 1px; width: 1px; overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; border: 0; padding: 0; margin: -1px;
    }
  </style>
</head>
<body data-theme="light">
  <div class="container" role="main">
    <header>
      <h1>Sealing Blessing — Ceremony Overlay</h1>
      <div class="controls" aria-label="Global controls">
        <button id="theme">Theme: Light</button>
        <select id="font" aria-label="Font size">
          <option value="100">Font: 100%</option>
          <option value="112">Font: 112%</option>
          <option value="125">Font: 125%</option>
          <option value="140">Font: 140%</option>
          <option value="160">Font: 160%</option>
        </select>
        <button id="print" class="ghost">Print</button>
        <button id="copy" class="ghost">Copy text</button>
        <button id="ceremonyBtn" class="primary">Start ceremony</button>
      </div>
    </header>

    <div class="grid">
      <section class="panel" aria-labelledby="edit-title">
        <h2 id="edit-title">Editor</h2>
        <label for="title">Title</label>
        <input id="title" type="text" value="Sealing the Anointing — Blessing for Healing and Peace" />
        <label for="text">Sealing text (editable)</label>
        <div id="text" class="editable" contenteditable="true" aria-label="Editable sealing text">
By the authority of the Melchizedek Priesthood, and in the name of Jesus Christ, we lay our hands upon your head and seal the anointing which has been given.

We seal upon you the promises of healing, that your body may be strengthened and renewed according to the will of the Lord. We seal upon you the peace of Christ, that your mind may rest in calm assurance and your heart be lifted in hope.

We seal upon you the companionship of angels, that they may encircle you in light, guard your steps, and whisper comfort in your quiet hours. We seal upon you the sanctuary of the Spirit, that wherever you dwell, holiness may abide and your home be filled with love.

We seal upon you the courage of prophets, the patience of saints, and the faith of disciples, that you may endure trials with dignity and rise with joy. We seal upon you remembrance—that you are known, cherished, and never forgotten by your Heavenly Father.

We seal upon you the blessings of family unity, that bonds of love may be strengthened and your household be a refuge of peace. We seal upon you the testimony of Christ, that His light may shine through you as a beacon to others in need.

We seal all these blessings upon you, according to your faith and the will of the Lord, in the sacred name of Jesus Christ, amen.
        </div>

        <label for="aff">Affirmations (one per line)</label>
        <textarea id="aff" rows="6">You are known and loved of God.
Angels attend you in quiet hours.
Peace in Christ steadies your heart.
Strength will meet you in this moment.</textarea>

        <div class="footer-controls">
          <button id="load" class="primary">Load into reader</button>
          <button id="toggleAff" class="ghost">Toggle affirmations</button>
        </div>
      </section>

      <section class="panel" aria-labelledby="read-title">
        <h2 id="read-title">Reader</h2>
        <p class="muted">Keyboard: Arrow keys navigate • A toggle affirmations • T theme • C ceremony • +/- font</p>
        <div class="progress" aria-hidden="true">
          <div class="dot on"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
        <div id="reader" class="reading" aria-live="polite">
          <div id="lines"></div>
          <div id="affirm" class="affirm" aria-hidden="true"></div>
          <div class="footer-controls">
            <button id="prev" class="ghost">← Previous</button>
            <button id="next" class="primary">Next →</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Ceremony overlay -->
  <div id="overlay" class="ceremony" aria-hidden="true">
    <div class="ceremony-inner">
      <h2 id="ceremonyTitle">Sealing the Anointing — Blessing</h2>
      <div class="focus-ring">
        <div id="ceremonyLines"></div>
        <div id="ceremonyAff" class="affirm" aria-hidden="true"></div>
        <div class="footer-controls" style="margin-top: 12px;">
          <button id="cPrev" class="ghost">← Previous</button>
          <button id="cNext" class="primary">Next →</button>
          <button id="cExit" class="ghost">Exit</button>
        </div>
        <p class="muted">Tip: Read slowly, pause with reverence, let promises arise naturally.</p>
      </div>
    </div>
  </div>

  <script>
    const state = {
      theme: 'light',
      font: 100,
      lines: [],
      index: 0,
      showAff: false,
      affs: []
    };

    const el = {
      theme: document.getElementById('theme'),
      font: document.getElementById('font'),
      print: document.getElementById('print'),
      copy: document.getElementById('copy'),
      ceremonyBtn: document.getElementById('ceremonyBtn'),
      title: document.getElementById('title'),
      text: document.getElementById('text'),
      aff: document.getElementById('aff'),
      load: document.getElementById('load'),
      toggleAff: document.getElementById('toggleAff'),
      lines: document.getElementById('lines'),
      affirm: document.getElementById('affirm'),
      prev: document.getElementById('prev'),
      next: document.getElementById('next'),
      overlay: document.getElementById('overlay'),
      ceremonyTitle: document.getElementById('ceremonyTitle'),
      ceremonyLines: document.getElementById('ceremonyLines'),
      ceremonyAff: document.getElementById('ceremonyAff'),
      cPrev: document.getElementById('cPrev'),
      cNext: document.getElementById('cNext'),
      cExit: document.getElementById('cExit'),
      body: document.body
    };

    function parseText() {
      const paras = el.text.innerText
        .split(/\n{2,}/).map(s => s.trim()).filter(Boolean);
      state.lines = paras.map((t, i) => ({
        text: t,
        meta: i === 0 ? 'Sealing authority & invocation' :
              i === paras.length - 1 ? 'Closing & sealing in Christ' :
              'Blessing promises'
      }));
      state.index = 0;
    }

    function parseAffs() {
      state.affs = el.aff.value.split('\n').map(s => s.trim()).filter(Boolean);
    }

    function render(target, list, active) {
      target.innerHTML = '';
      list.forEach((line, i) => {
        const div = document.createElement('div');
        div.className = 'line' + (i === active ? ' active' : '');
        div.textContent = line.text;
        const meta = document.createElement('small');
        meta.textContent = line.meta || '';
        div.appendChild(meta);
        target.appendChild(div);
      });
    }

    function updateAff(target) {
      if (!state.showAff || state.affs.length === 0) {
        target.classList.remove('show');
        target.setAttribute('aria-hidden', 'true');
        target.textContent = '';
        return;
      }
      const msg = state.affs[state.index % state.affs.length];
      target.textContent = msg;
      target.classList.add('show');
      target.setAttribute('aria-hidden', 'false');
    }

    function toNext() {
      if (state.index < state.lines.length - 1) state.index++;
      render(el.lines, state.lines, state.index);
      render(el.ceremonyLines, state.lines, state.index);
      updateAff(el.affirm);
      updateAff(el.ceremonyAff);
    }

    function toPrev() {
      if (state.index > 0) state.index--;
      render(el.lines, state.lines, state.index);
      render(el.ceremonyLines, state.lines, state.index);
      updateAff(el.affirm);
      updateAff(el.ceremonyAff);
    }

    function toggleTheme() {
      state.theme = state.theme === 'light' ? 'dark' : 'light';
      el.body.setAttribute('data-theme', state.theme);
      el.theme.textContent = 'Theme: ' + (state.theme === 'light' ? 'Light' : 'Dark');
    }

    function setFont(val) {
      state.font = parseInt(val, 10);
      document.documentElement.style.fontSize = state.font + '%';
    }

    function copyText() {
      const txt = [el.title.value, ...state.lines.map(l => l.text)].join('\n\n');
      navigator.clipboard.writeText(txt).then(() => {
        el.copy.textContent = 'Copied!';
        setTimeout(() => el.copy.textContent = 'Copy text', 1200);
      });
    }

    function enterCeremony() {
      el.overlay.classList.add('active');
      el.overlay.setAttribute('aria-hidden', 'false');
      el.ceremonyTitle.textContent = el.title.value || 'Sealing Blessing';
      render(el.ceremonyLines, state.lines, state.index);
      updateAff(el.ceremonyAff);
    }
    function exitCeremony() {
      el.overlay.classList.remove('active');
      el.overlay.setAttribute('aria-hidden', 'true');
    }

    // Events
    el.theme.addEventListener('click', toggleTheme);
    el.font.addEventListener('change', e => setFont(e.target.value));
    el.print.addEventListener('click', () => window.print());
    el.copy.addEventListener('click', copyText);
    el.load.addEventListener('click', () => { parseText(); parseAffs(); render(el.lines, state.lines, state.index); updateAff(el.affirm); });
    el.toggleAff.addEventListener('click', () => {
      state.showAff = !state.showAff;
      updateAff(el.affirm);
      updateAff(el.ceremonyAff);
      el.toggleAff.textContent = state.showAff ? 'Hide affirmations' : 'Show affirmations';
    });
    el.prev.addEventListener('click', toPrev);
    el.next.addEventListener('click', toNext);
    el.ceremonyBtn.addEventListener('click', () => {
      if (state.lines.length === 0) { parseText(); parseAffs(); }
      enterCeremony();
    });
    el.cPrev.addEventListener('click', toPrev);
    el.cNext.addEventListener('click', toNext);
    el.cExit.addEventListener('click', exitCeremony);

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') toNext();
      else if (e.key === 'ArrowLeft') toPrev();
      else if (e.key.toLowerCase() === 'a') { state.showAff = !state.showAff; updateAff(el.affirm); updateAff(el.ceremonyAff); }
      else if (e.key.toLowerCase() === 't') toggleTheme();
      else if (e.key.toLowerCase() === 'c') enterCeremony();
      else if (e.key === '+') { setFont(Math.min(state.font + 12, 180)); el.font.value = state.font; }
      else if (e.key === '-') { setFont(Math.max(state.font - 12, 90)); el.font.value = state.font; }
    });

    // Initial render
    parseText(); parseAffs(); render(el.lines, state.lines, state.index); updateAff(el.affirm);
  </script>
</body>
</html>
